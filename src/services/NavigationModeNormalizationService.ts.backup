/**
 * Navigation Mode Display Service
 * 
 * ✅ LEGACY CLEANUP COMPLETE: Simplified to essential display functionality only
 * ✅ CORE RULES COMPLIANT: No hardcoded conversions, use navigation-safe.ts for any normalization
 * 
 * Key Features:
 * - User-friendly navigation mode display names
 * - Single responsibility: Display only
 * 
 * ARCHITECTURE ALIGNMENT:
 * - Uses navigation-safe.ts types for consistency
 * - Field-mapper compliant for any future database integration
 * - PATHS compliant (no direct path operations)
 * 
 * @since v1.0.59
 * @date 2025-10-29 (Legacy cleanup)
 */

// ✅ CLEAN: Import from navigation-safe.ts - single source of truth
import { type NavigationMode, isValidNavigationMode, NAVIGATION_MODE_DESCRIPTIONS } from '../types/navigation-safe';

/**
 * Get user-friendly display name for navigation mode
 * ✅ CORE RULES COMPLIANT: Uses NAVIGATION_MODE_DESCRIPTIONS from navigation-safe.ts
 */
export function getNavigationModeDisplayName(mode: string): string {
  // ✅ Validation using navigation-safe.ts
  if (isValidNavigationMode(mode)) {
    return NAVIGATION_MODE_DESCRIPTIONS[mode];
  }
  
  // Fallback for unknown modes
  return mode.replace('mode-', '').replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
}

// ✅ LEGACY DEBT REMOVED: All complex conversion logic eliminated
// ✅ LEGACY DEBT REMOVED: No more NAVIGATION_MODE_MAPPING pollution
// ✅ LEGACY DEBT REMOVED: No more duplicate type definitions
// ✅ LEGACY DEBT REMOVED: No more migration helper functions
// Use navigation-safe.ts normalizeToKiSafe() for any needed conversion

/**
 * Check if a mode is a legacy mode
 */
export function isLegacyMode(mode: string): mode is LegacyNavigationMode {
  return LEGACY_MODES.includes(mode as LegacyNavigationMode);
}

/**
 * Check if a mode is a KI-safe mode
 */
export function isKiSafeMode(mode: string): mode is KiSafeNavigationMode {
  return KI_SAFE_MODES.includes(mode as KiSafeNavigationMode);
}

/**
 * Validate any navigation mode input
 */
export function validateNavigationMode(mode: string): mode is NavigationModeInput {
  return ALL_MODES.includes(mode as NavigationModeInput);
}

/**
 * Convert Legacy mode to KI-safe mode
 */
export function normalizeToKiSafe(mode: NavigationModeInput): KiSafeNavigationMode {
  if (isKiSafeMode(mode)) {
    return mode;
  }
  
  if (isLegacyMode(mode)) {
    return NAVIGATION_MODE_MAPPING[mode] as KiSafeNavigationMode;
  }
  
  console.warn(`[NavigationModeNormalization] Unknown mode: ${mode}, defaulting to mode-dashboard-view`);
  return 'mode-dashboard-view';
}

/**
 * Get user-friendly display name for navigation mode
 */
export function getNavigationModeDisplayName(mode: NavigationModeInput): string {
  const kiSafeMode = normalizeToKiSafe(mode);
  
  switch (kiSafeMode) {
    case 'mode-dashboard-view':
      return 'Dashboard View';
    case 'mode-data-panel':
      return 'Data Panel';
    case 'mode-compact-focus':
      return 'Compact Focus';
    default:
      return 'Unknown Mode';
  }
}

/**
 * Migration helper: Update user preferences from Legacy to KI-safe
 */
export interface UserNavigationPreference {
  userId: string;
  currentMode: NavigationModeInput;
  preferences?: Record<string, any>;
}

export function migrateUserPreferences(userPrefs: UserNavigationPreference[]): UserNavigationPreference[] {
  return userPrefs.map(userPref => ({
    ...userPref,
    currentMode: normalizeToKiSafe(userPref.currentMode)
  }));
}

/**
 * Database query helper: Get CSS Grid values for navigation mode
 */
export function getGridConfigForMode(mode: NavigationModeInput): {
  templateAreas: string;
  templateColumns: string;
  templateRows: string;
} {
  const kiSafeMode = normalizeToKiSafe(mode);
  
  const configs = {
    'mode-dashboard-view': {
      templateAreas: '"sidebar header" "sidebar main"',
      templateColumns: '240px 1fr',
      templateRows: '160px 1fr' // Statistics header larger, NO FOOTER ROW
    },
    'mode-data-panel': {
      templateAreas: '"sidebar header" "sidebar main"',
      templateColumns: '280px 1fr', // Wider sidebar for navigation
      templateRows: '160px 1fr' // NO FOOTER ROW
    },
    'mode-compact-focus': {
      templateAreas: '"sidebar header" "sidebar main"',
      templateColumns: '240px 1fr',
      templateRows: '36px 1fr' // Minimal header, NO FOOTER ROW
    }
  };
  
  return configs[kiSafeMode];
}

/**
 * CSS Variables helper: Generate CSS custom properties for navigation mode
 */
export function generateCssVariablesForMode(mode: NavigationModeInput): Record<string, string> {
  const kiSafeMode = normalizeToKiSafe(mode);
  const config = getGridConfigForMode(kiSafeMode);
  
  return {
    [`--db-${kiSafeMode}-grid-template-areas`]: config.templateAreas,
    [`--db-${kiSafeMode}-grid-template-columns`]: config.templateColumns,
    [`--db-${kiSafeMode}-grid-template-rows`]: config.templateRows
  };
}