<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Angebot {{offer.offerNumber}}</title>
  
  <!-- DIN 5008 compliant CSS for professional German business documents -->
  <style>
    @page {
      size: A4;
      margin: 2.5cm 2cm 2cm 2.5cm; /* DIN 5008: Links 2,5cm, re      margin: 2.5cm 2cm 2cm 2.5cm; /* DIN 5008: Links 2,5cm, rechts 2cm, oben 2,5cm, unten 2cm */
    }
    
    body {
      font-family: 'Arial', 'Helvetica', sans-serif;
      font-size: 11pt; /* DIN 5008 Standard-Schriftgröße */
      line-height: 1.3;
      color: #000;
      margin: 0;
      padding: 0;
      background: white;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    /* DIN 5008 Briefkopf-Bereich */
    .letterhead {
      position: relative;
      height: 4.5cm; /* DIN 5008: Briefkopf bis 4,5cm */
      margin-bottom: 2cm;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .company-info {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      font-size: 9pt;
      color: #333;
    }
    
    .company-name {
      font-size: 14pt;
      font-weight: bold;
      color: #1e3a2e; /* This should be replaced by theme color */
      margin-bottom: 0.3cm;
    }
    
    .company-details {
      line-height: 1.2;
    }
    
    .logo {
      position: absolute;
      top: 0;
      right: 0;
      max-width: 4cm;
      max-height: 2.5cm;
      object-fit: contain;
    }
    
    /* DIN 5008 Anschriftenfeld */
    .address-field {
      width: 8.5cm; /* DIN 5008: Anschriftenfeld 8,5cm breit */
      margin-bottom: 2cm;
      position: relative;
    }
    
    .sender-line {
      font-size: 8pt;
      color: #666;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.1cm;
      margin-bottom: 0.3cm;
      line-height: 1.1;
    }
    
    .recipient-address {
      font-size: 11pt;
      line-height: 1.2;
    }
    
    .recipient-name {
      font-weight: bold;
      margin-bottom: 0.2cm;
    }
    
    /* Informationsblock */
    .info-block {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5cm;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 0.5cm;
    }
    
    .info-left, .info-right {
      width: 48%;
    }
    
    .info-row {
      display: flex;
      margin-bottom: 0.2cm;
    }
    
    .info-label {
      width: 3.5cm;
      font-weight: bold;
      color: #1e3a2e; /* Theme Primary Color - wird ersetzt */
    }
    
    .info-value {
      flex: 1;
    }
    
    /* Dokumenttitel */
    .document-title {
      font-size: 16pt;
      font-weight: bold;
      color: #1e3a2e; /* Theme Primary Color - wird ersetzt */
      margin: 1.5cm 0 1cm 0;
      text-align: left;
    }
    
    /* Ansprache und Einleitung */
    .salutation {
      margin-bottom: 1cm;
      line-height: 1.4;
    }
    
    /* Tabelle für Positionen */
    .positions-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5cm 0;
      border: 1px solid #d0d0d0;
      page-break-inside: auto;
    }
    
    .positions-table th,
    .positions-table td {
      padding: 0.4cm 0.3cm;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      vertical-align: top;
      page-break-inside: avoid;
    }
    
    .positions-table thead {
      page-break-after: avoid;
    }
    
    .positions-table tr {
      page-break-inside: avoid;
    }
    
    .positions-table th {
      background-color: #f8f9fa; /* Theme Background - wird ersetzt */
      font-weight: bold;
      color: #1e3a2e; /* Theme Primary Color - wird ersetzt */
      font-size: 10pt;
    }
    
    .positions-table td {
      font-size: 10pt;
    }
    
    .position-title {
      font-weight: bold;
      margin-bottom: 0.1cm;
    }
    
    .position-description {
      font-size: 9pt;
      color: #555;
      font-style: italic;
    }
    
    .sub-position {
      padding-left: 1cm;
      background-color: #fafafa;
    }
    
    .text-right {
      text-align: right;
    }
    
    .text-center {
      text-align: center;
    }
    
    /* Summen-Bereich */
    .totals-section {
      margin-top: 1cm;
      display: flex;
      justify-content: flex-end;
      page-break-inside: avoid;
      margin-bottom: 1cm;
    }
    
    .totals-table {
      width: 6cm;
      border-collapse: collapse;
    }
    
    .totals-table td {
      padding: 0.2cm 0.3cm;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .totals-table .label {
      text-align: left;
      font-weight: normal;
    }
    
    .totals-table .amount {
      text-align: right;
      font-weight: bold;
    }
    
    .total-final {
      border-top: 2px solid #1e3a2e; /* Theme Primary Color - wird ersetzt */
      font-size: 12pt;
      font-weight: bold;
      color: #1e3a2e; /* Theme Primary Color - wird ersetzt */
    }
    
    /* Steuerhinweis */
    .tax-note {
      font-size: 9pt;
      color: #666;
      font-style: italic;
      margin-top: 0.5cm;
    }
    
    /* Schlusstext */
    .closing-text {
      margin: 1.5cm 0;
      line-height: 1.4;
      page-break-inside: avoid;
    }
    
    /* Anmerkungen */
    .notes-section {
      margin-top: 2cm;
      padding-top: 0.5cm;
      border-top: 1px solid #e0e0e0;
      page-break-inside: avoid;
    }
    
    .notes-title {
      font-weight: bold;
      color: #1e3a2e; /* Theme Primary Color - wird ersetzt */
      margin-bottom: 0.5cm;
    }
    
    .notes-content {
      line-height: 1.4;
      white-space: pre-wrap;
    }
    
    /* Footer für Geschäftsangaben */
    .business-footer {
      margin-top: 3cm;
      font-size: 8pt;
      color: #666;
      line-height: 1.2;
      border-top: 1px solid #e0e0e0;
      padding-top: 0.3cm;
      page-break-inside: avoid;
    }
    
    /* Print-spezifische Anpassungen */
    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      .positions-table th {
        background-color: #f8f9fa !important;
      }
      
      .sub-position {
        background-color: #fafafa !important;
      }
    }
    
    /* Responsive Anpassungen für Vorschau */
    @media screen and (max-width: 21cm) {
      body {
        padding: 1cm;
      }
      
      .address-field {
        width: 100%;
        max-width: 8.5cm;
      }
      
      .info-block {
        flex-direction: column;
      }
      
      .info-left, .info-right {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Briefkopf nach DIN 5008 -->
  <div class="letterhead">
    <div class="company-info">
      <div class="company-name">{{company.name}}</div>
      <div class="company-details">
        {{company.street}}<br>
        {{company.zip}} {{company.city}}<br>
        {{#if company.phone}}Tel: {{company.phone}}<br>{{/if}}
        {{#if company.email}}E-Mail: {{company.email}}<br>{{/if}}
        {{#if company.website}}Web: {{company.website}}{{/if}}
      </div>
    </div>
    {{#if logo}}
    <img src="{{logo}}" alt="{{company.name}} Logo" class="logo">
    {{/if}}
  </div>
  
  <!-- Anschriftenfeld nach DIN 5008 -->
  <div class="address-field">
    <div class="sender-line">
      {{company.name}} · {{company.street}} · {{company.zip}} {{company.city}}
    </div>
    <div class="recipient-address">
      <div class="recipient-name">{{customer.name}}</div>
      {{#if customer.street}}{{customer.street}}<br>{{/if}}
      {{#if customer.zip}}{{customer.zip}} {{customer.city}}{{/if}}
    </div>
  </div>
  
  <!-- Informationsblock -->
  <div class="info-block">
    <div class="info-left">
      <div class="info-row">
        <span class="info-label">Angebots-Nr.:</span>
        <span class="info-value">{{offer.offerNumber}}</span>
      </div>
      <div class="info-row">
        <span class="info-label">Datum:</span>
        <span class="info-value">{{formatDate offer.createdAt}}</span>
      </div>
      {{#if customer.email}}
      <div class="info-row">
        <span class="info-label">E-Mail:</span>
        <span class="info-value">{{customer.email}}</span>
      </div>
      {{/if}}
    </div>
    <div class="info-right">
      <div class="info-row">
        <span class="info-label">Gültig bis:</span>
        <span class="info-value">{{formatDate offer.validUntil}}</span>
      </div>
      {{#if customer.phone}}
      <div class="info-row">
        <span class="info-label">Telefon:</span>
        <span class="info-value">{{customer.phone}}</span>
      </div>
      {{/if}}
    </div>
  </div>
  
  <!-- Dokumenttitel -->
  <h1 class="document-title">Angebot</h1>
  
  <!-- Ansprache -->
  <div class="salutation">
    <p>Sehr geehrte Damen und Herren,</p>
    <p>vielen Dank für Ihr Interesse. Gerne unterbreiten wir Ihnen folgendes Angebot:</p>
  </div>
  
  <!-- Betreff -->
  {{#if offer.title}}
  <div style="margin-bottom: 1cm;">
    <strong>Betreff: {{offer.title}}</strong>
  </div>
  {{/if}}
  
  <!-- Positionen-Tabelle -->
  <table class="positions-table">
    <thead>
      <tr>
        <th style="width: 50%;">Position</th>
        <th style="width: 10%;" class="text-center">Menge</th>
        <th style="width: 20%;" class="text-right">Einzelpreis (€)</th>
        <th style="width: 20%;" class="text-right">Gesamtpreis (€)</th>
      </tr>
    </thead>
    <tbody>
      {{#each offer.lineItems}}
      <tr {{#if this.parentItemId}}class="sub-position"{{/if}}>
        <td>
          <div class="position-title">
            {{#if this.parentItemId}}↳ {{/if}}{{this.title}}
          </div>
          {{#if this.description}}
          <div class="position-description">{{this.description}}</div>
          {{/if}}
        </td>
        <td class="text-center">{{this.quantity}}</td>
        <td class="text-right">{{formatCurrency this.unitPrice}}</td>
        <td class="text-right">{{formatCurrency this.total}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  
  <!-- Summen-Bereich -->
  <div class="totals-section">
    <table class="totals-table">
      <tr>
        <td class="label">Zwischensumme:</td>
        <td class="amount">{{formatCurrency offer.subtotal}}</td>
      </tr>
      {{#unless company.kleinunternehmer}}
      {{#if offer.vatAmount}}
      <tr>
        <td class="label">MwSt. ({{offer.vatRate}}%):</td>
        <td class="amount">{{formatCurrency offer.vatAmount}}</td>
      </tr>
      {{/if}}
      {{/unless}}
      <tr class="total-final">
        <td class="label">Gesamtbetrag:</td>
        <td class="amount">{{formatCurrency offer.total}}</td>
      </tr>
    </table>
  </div>
  
  <!-- Steuerhinweis bei Kleinunternehmer -->
  {{#if company.kleinunternehmer}}
  <div class="tax-note">
    Gemäß § 19 UStG wird keine Umsatzsteuer ausgewiesen.
  </div>
  {{/if}}
  
  <!-- Schlusstext -->
  <div class="closing-text">
    <p>Das Angebot ist gültig bis zum {{formatDate offer.validUntil}}.</p>
    <p>Wir freuen uns auf Ihre Rückmeldung und stehen für Rückfragen gerne zur Verfügung.</p>
  </div>
  
  <!-- Anmerkungen -->
  {{#if offer.notes}}
  <div class="notes-section">
    <div class="notes-title">Anmerkungen:</div>
    <div class="notes-content">{{offer.notes}}</div>
  </div>
  {{/if}}
  
  <!-- Grußformel -->
  <div style="margin-top: 2cm;">
    <p>Mit freundlichen Grüßen</p>
    <div style="margin-top: 1.5cm;">
      {{company.name}}
    </div>
  </div>
  
  <!-- Geschäftsangaben im Footer -->
  <div class="business-footer">
    <div style="text-align: center;">
      <strong>{{company.name}}</strong> · {{company.street}} · {{company.zip}} {{company.city}}<br>
      {{#if company.phone}}Tel: {{company.phone}}{{/if}}
      {{#if company.email}} · E-Mail: {{company.email}}{{/if}}
      {{#if company.website}} · Web: {{company.website}}{{/if}}<br>
      {{#if company.taxId}}Steuernummer: {{company.taxId}}{{/if}}
      {{#if company.vatId}} · USt-IdNr.: {{company.vatId}}{{/if}}
      {{#if company.bankName}} · {{company.bankName}}{{/if}}
      {{#if company.bankAccount}} · IBAN: {{company.bankAccount}}{{/if}}
      {{#if company.bankBic}} · BIC: {{company.bankBic}}{{/if}}
    </div>
  </div>
</body>
</html>