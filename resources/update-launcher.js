"use strict";var I=Object.create;var w=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var F=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var k=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of T(t))!A.call(e,a)&&a!==n&&w(e,a,{get:()=>t[a],enumerable:!(i=R(t,a))||i.enumerable});return e};var E=(e,t,n)=>(n=e!=null?I(D(e)):{},k(t||!e||!e.__esModule?w(n,"default",{value:e,enumerable:!0}):n,e));var $=F((O,y)=>{var P=require("fs"),m=require("path"),b=m.join(__dirname,"path.txt");function L(){let e;if(P.existsSync(b)&&(e=P.readFileSync(b,"utf-8")),process.env.ELECTRON_OVERRIDE_DIST_PATH)return m.join(process.env.ELECTRON_OVERRIDE_DIST_PATH,e||"electron");if(e)return m.join(__dirname,"dist",e);throw new Error("Electron failed to install correctly, please delete node_modules/electron and try installing again")}y.exports=L()});var l=require("child_process"),c=require("fs"),u=require("path"),p=require("os"),S=E($(),1),d;try{d=S.app.getPath("userData")}catch{d=(0,u.join)(process.env.APPDATA||(process.platform==="darwin"?(0,u.join)((0,p.userInfo)().homedir,"Library","Application Support"):(0,u.join)((0,p.userInfo)().homedir,".config")),"RawaLite")}try{(0,c.mkdirSync)(d,{recursive:!0})}catch{}var x=(0,u.join)(d,`update-launcher-${Date.now()}.log`);function r(e){let n=`[${new Date().toISOString()}] ${e}
`;console.log(n.trim());try{(0,c.writeFileSync)(x,n,{flag:"a"})}catch(i){console.error(`Fehler beim Schreiben des Logs: ${i}`)}}var g=process.argv.slice(2);g.length<2&&(r("\u274C Fehler: Parent-PID und Installer-Pfad m\xFCssen angegeben werden."),r("Verwendung: update-launcher.js <parent-pid> <installer-pfad> [options]"),process.exit(1));var h=parseInt(g[0],10),o=g[1],s={waitDelay:500,maxWaitTime:3e4,silent:!1,debug:!0};(isNaN(h)||h<=0)&&(r(`\u274C Fehler: Ung\xFCltige Parent-PID: ${h}`),process.exit(1));(0,c.existsSync)(o)||(r(`\u274C Fehler: Installer nicht gefunden: ${o}`),process.exit(1));for(let e=2;e<g.length;e++){let t=g[e];t==="--silent"&&(s.silent=!0),t==="--debug"&&(s.debug=!0),t.startsWith("--wait-delay=")&&(s.waitDelay=parseInt(t.split("=")[1],10)),t.startsWith("--max-wait=")&&(s.maxWaitTime=parseInt(t.split("=")[1],10)*1e3)}r("\u{1F680} RawaLite Update-Launcher gestartet");r(`\u{1F4CA} Konfiguration: ${JSON.stringify({installerPath:o,parentPid:h,options:s,logPath:x})}`);function _(e){return new Promise(t=>{try{try{process.kill(e,0),s.debug&&r(`\u{1F50D} Prozess ${e} l\xE4uft (signal check)`),t(!0)}catch{s.debug&&r(`\u{1F50D} Prozess ${e} beendet (signal check)`),t(!1)}}catch(n){process.platform==="win32"?(0,l.execFile)("tasklist",["/FI",`PID eq ${e}`,"/NH"],(i,a)=>{if(i)r(`\u26A0\uFE0F Fehler bei tasklist: ${i.message}`),t(!1);else{let f=a.toLowerCase().includes(e.toString());s.debug&&r(`\u{1F50D} Prozess ${e} l\xE4uft: ${f} (tasklist)`),t(f)}}):(r(`\u26A0\uFE0F Allgemeiner Fehler bei Prozesspr\xFCfung: ${n}`),t(!1))}})}async function z(e){r(`\u23F3 \xDCberwache Prozess ${e} bis zur Beendigung...`);let t=Date.now(),n=0;for(;;){if(!await _(e)){r(`\u2705 Prozess ${e} wurde beendet`);break}if(n=Date.now()-t,n>=s.maxWaitTime){r(`\u26A0\uFE0F Timeout nach ${n}ms. Fortfahren trotz laufendem Prozess.`);break}s.debug&&n%3e3<s.waitDelay&&r(`\u23F1\uFE0F Warte seit ${Math.round(n/1e3)}s auf Beendigung von Prozess ${e}`),await new Promise(a=>setTimeout(a,s.waitDelay))}}async function U(){r(`\u{1F680} Starte Update-Installer: ${o}`);try{return new Promise(e=>{(0,l.exec)(`"${o}"`,(t,n,i)=>{if(t){r(`\u26A0\uFE0F Standard-Start fehlgeschlagen: ${t.message}`),r("\u{1F504} Versuche Fallback mit PowerShell erh\xF6hte Rechte...");let a=(0,l.spawn)("powershell.exe",["-NoProfile","-ExecutionPolicy","Bypass","-Command",`Start-Process -FilePath "${o}" -Verb RunAs`],{detached:!0,stdio:"ignore",windowsHide:!s.debug});a.on("error",f=>{r(`\u274C PowerShell-Fallback fehlgeschlagen: ${f.message}`),e(!1)}),a.unref(),r("\u2705 Installer \xFCber PowerShell mit erh\xF6hten Rechten gestartet"),e(!0)}else r("\u2705 Installer erfolgreich direkt gestartet"),e(!0)})})}catch(e){return r(`\u274C Alle Startmethoden fehlgeschlagen: ${e}`),!1}}async function W(){r("\u23F3 Warte auf Beendigung der RawaLite-Anwendung...");try{await z(h),r("\u2705 RawaLite-Anwendung beendet. Warte noch 1 Sekunde f\xFCr Ressourcenfreigabe..."),await new Promise(t=>setTimeout(t,1e3)),await U()?(r("\u2705 Update-Launcher hat seine Aufgabe erf\xFCllt. Wird beendet."),setTimeout(()=>process.exit(0),1e3)):(r("\u274C Installer konnte nicht gestartet werden."),process.exit(1))}catch(e){r(`\u274C Unerwarteter Fehler im Update-Launcher: ${e}`),process.exit(1)}}W().catch(e=>{r(`\u274C Unerwarteter Fehler: ${e}`),process.exit(1)});
